<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>You&Ra Center 나는 어떤 감각 유형일까?</title>
<style>
 :root{--bg:#faf7f2;--card:#ffffff;--ink:#1f2421;--muted:#6b6b6b;--brand:#1c4e80;--line:#ececec;--scale:1}
 *{box-sizing:border-box}
 html{font-size:calc(16px * var(--scale))}
 body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Apple SD Gothic Neo","Malgun Gothic",sans-serif}
 .wrap{max-width:900px;margin:28px auto;padding:0 16px}
 .card{background:var(--card);border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.06);padding:18px 16px;margin-bottom:16px}
 header.card{display:flex;gap:16px;align-items:center}
 h1{margin:0 0 4px}
 .brand-text{font-weight:800;color:var(--brand);font-size:20px;letter-spacing:.2px}
 .muted{color:var(--muted)}
 .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
 .controls label{display:flex;align-items:center;gap:6px;background:#f6f8fb;border:1px solid #cfd8e3;padding:6px 10px;border-radius:10px;cursor:pointer}
 .q-area{min-height:120px;display:flex;align-items:center;justify-content:center;text-align:center;font-size:18px;padding:10px}
 .likert{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
 .likert button{border:1px solid #cfd8e3;background:#f6f8fb;border-radius:12px;padding:12px 14px;cursor:pointer;font-weight:700;min-width:110px;line-height:1.2}
 .likert button span{display:block;font-size:.85em;font-weight:600;margin-top:2px;color:#555}
 .likert button.active{background:var(--brand);color:#fff;border-color:var(--brand)}
 .nav{display:flex;gap:8px;margin-top:12px}
 .nav button{flex:1;border:none;background:var(--brand);color:#fff;border-radius:10px;padding:12px;font-weight:700;cursor:pointer}
 .nav button.secondary{background:#eaeaea;color:#1f1f1f}
 .nav button:disabled{opacity:.45;cursor:not-allowed}
 .progress{height:8px;background:#f0f3f5;border-radius:999px;overflow:hidden;margin-top:8px}
 .bar{height:8px;background:linear-gradient(90deg,#1c74d8,#00b2a9);width:0%}
 .result{background:var(--card);border-left:6px solid var(--brand);padding:14px;border-radius:10px;margin-top:12px}
 .result-card{display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap;margin-top:12px}
 .small{font-size:12px;color:var(--muted)}
 .hrow{display:flex;align-items:center;gap:10px;margin:8px 0}
 .hrow .label{width:70px;font-weight:600}
 .hbar{flex:1;height:10px;background:#f0f3f5;border-radius:999px;overflow:hidden}
 .fill{height:100%;background:linear-gradient(90deg,#1c74d8,#00b2a9);width:0%}
 .pct{width:48px;text-align:right;font-variant-numeric:tabular-nums}
 .reason{margin:8px 0 0 0;padding-left:18px}
 .reason li{margin:4px 0}
</style>
</head>
<body>
<div class="wrap">
  <header class="card">
    <div class="brand-text">You&Ra</div>
    <div>
      <h1>나는 어떤 감각 유형일까?</h1>
      <div class="muted">총 30문항 · 5점 척도(1 전혀 아님 ~ 5 매우 그럼). 큰 글씨/읽어주기/건너뛰기 기능을 제공합니다.</div>
    </div>
  </header>

  <div class="card controls" aria-label="접근성 옵션">
    <label><input type="checkbox" id="fontToggle"> 큰 글씨</label>
    <label><input type="checkbox" id="skipToggle" checked> 건너뛰기 허용</label>
    <button id="ttsBtn" type="button" class="secondary" style="border:1px solid #cfd8e3;background:#fff;color:#1f1f1f;border-radius:10px;padding:8px 12px;cursor:pointer">읽어주기</button>
  </div>

  <div id="exam" class="card">
    <div class="q-area" id="qText">로딩 중…</div>
    <div class="likert" id="likert" role="radiogroup" aria-label="응답 선택"></div>
    <div class="nav">
      <button id="prevBtn" class="secondary">이전</button>
      <button id="nextBtn">다음</button>
    </div>
    <div style="display:flex;justify-content:space-between;margin-top:8px;">
      <div class="small" id="counter">0 / 30</div>
    </div>
    <div class="progress"><div class="bar" id="bar"></div></div>
  </div>

  <div id="out" class="result" style="display:none"></div>

  <div class="card" style="display:flex;gap:8px;flex-wrap:wrap">
    <button id="restart" class="secondary">처음부터 다시</button>
    <button id="exportBtn" class="secondary">CSV 내보내기</button>
  </div>
</div>

<script>
(function(){
  // 문항: 쉬운 문장만 사용 (역문항: 6,12,18,24,30)
  const ITEMS = [
    ["1","주변이 지저분하면 정리하기 전엔 일이 잘 안 된다.","A",false],
    ["2","글자와 배경이 비슷한 화면을 오래 보면 눈이 빨리 피곤하다.","A",false],
    ["3","조명 밝기가 바뀌면 금방 적응하기 어렵다.","A",false],
    ["4","공간 색이 달라지면 일 속도나 실수가 달라진다.","A",false],
    ["5","밝은 빛을 오래 보면 그 뒤에 멍하거나 두통이 온다.","A",false],
    ["6","주변이 지저분해도 해야 할 일만 보면 괜찮다.","A",true],
    ["7","여러 사람이 동시에 말하면 대화 내용을 놓치기 쉽다.","B",false],
    ["8","시끄러우면 집중이 잘 안 된다.","B",false],
    ["9","반복되는 소리가 계속 들리면 몸이 긴장된다.","B",false],
    ["10","사람 많은 곳은 소리 때문에 금방 지친다.","B",false],
    ["11","명령조 같은 말투에 먼저 반응한다.","B",false],
    ["12","일에 몰입하면 주변 소음이 신경 쓰이지 않는다.","B",true],
    ["13","옷 라벨이나 시계줄이 거슬려 오래 못 한다.","C",false],
    ["14","환경(온도·습도)이 바뀌면 감정도 바뀐다.","C",false],
    ["15","낯선 사람이 툭 건드리면 몸이 먼저 움찔한다.","C",false],
    ["16","긴장하면 어깨나 턱 등 몸이 뻣뻣해진다.","C",false],
    ["17","부드러운 촉감을 잠깐 만져도 편안해진다.","C",false],
    ["18","옷감이나 침구의 재질은 별로 신경 쓰지 않는다.","C",true],
    ["19","냄새 변화를 남들보다 빨리 알아차린다.","D",false],
    ["20","낯선 냄새가 나면 어디서 나는지 찾느라 집중이 흐트러진다.","D",false],
    ["21","냄새가 사라져도 그 느낌이 한동안 남는다.","D",false],
    ["22","익숙한 냄새를 맡으면 상황과 상관없이 안심이 된다.","D",false],
    ["23","비슷한 향도 세기나 잔향 차이를 잘 구분한다.","D",false],
    ["24","냄새가 강해져도 일하는 데 거의 영향이 없다.","D",true],
    ["25","식사 시간이 흐트러지면 집중이 먼저 떨어진다.","E",false],
    ["26","스트레스 받으면 매운맛·짠맛·단맛 같은 음식을 자주 찾는다.","E",false],
    ["27","식사를 거르면 예민해진다.","E",false],
    ["28","기대한 맛이 아니면 다른 메뉴로 바꾸거나 먹는 걸 멈춘다.","E",false],
    ["29","새로운 맛은 잘 안 먹으려 한다.","E",false],
    ["30","식사 시간이나 메뉴가 달라도 기분은 큰 변화가 없다.","E",true]
  ];

  // 결과 카드 텍스트(‘당신은 …’ 톤)
  const TEXTS = {
    A:{title:"시각형",
       feature:["당신은 시각 자극에 민감해요.","당신은 정돈된 구조와 차분한 색에서 안정감을 느껴요."],
       routine:["정리·정돈","무채색 환경","자연광 독서/명상","컬러 만다라"],
       desc:"빛의 세기·대비·색감·시각적 혼잡에 반응이 빠른 편입니다. 정돈된 시야와 부드러운 색조에서 집중과 회복이 잘 일어납니다."},
    B:{title:"청각형",
       feature:["당신은 소리의 크기·톤·겹침에 민감해요.","당신은 지속되는 소음에서 에너지가 빨리 소모돼요."],
       routine:["백색소음","플레이리스트","조용한 시간","자기 확언 말하기(소리와 함께 명상 도움)"],
       desc:"겹치는 말소리, 군중 소음, 특정 억양에 민감합니다. 예측 가능한 소리 환경과 ‘조용한 구간’이 퍼포먼스에 도움됩니다."},
    C:{title:"촉각형",
       feature:["당신은 촉감과 압박감에 민감해요.","당신은 부드럽고 따뜻한 촉감에서 편안함을 느껴요."],
       routine:["손 공예","담요·따뜻한 물건","스트레칭+마사지","감정 일기"],
       desc:"피부 압박·온습도 변화·스킨십에 신체 반응이 먼저 나타납니다. 부드러운 섬유·따뜻함·가벼운 압박이 이완에 효과적입니다."},
    D:{title:"후각형",
       feature:["당신은 향의 변화에 빠르게 반응해요.","당신은 익숙한 향에서 안정을, 과한 향에서 피로를 느낄 수 있어요."],
       routine:["향초·아로마","향기 노트","자연 향 맡기","창작 활동"],
       desc:"냄새 변화를 가장 먼저 포착하고 감정 여진이 남기 쉽습니다. 익숙한 향은 안정을, 과한 향은 집중 저하를 유발할 수 있습니다."},
    E:{title:"미각형",
       feature:["당신은 배고픔과 맛 경험이 기분에 큰 영향을 줘요.","당신은 규칙적인 식사와 따뜻한 음료에서 쉽게 안정돼요."],
       routine:["감정 음식 기록","식사=회복 루틴","따뜻한 음료"],
       desc:"식사 규칙·맛 기대와 실제 경험의 차이가 정서에 영향을 줍니다. 스트레스 상황에서는 특정 맛을 더 찾을 수 있어요."}
  };

  let order=[], idx=0, answers={};

  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

  function newRun(){
    order = shuffle([...ITEMS]); // 내용은 무작위, 화면 번호는 1→30
    idx = 0; answers = {};
    document.getElementById("out").style.display="none";
    render();
  }

  function render(){
    const it = order[idx]; if(!it) return;
    document.getElementById("qText").innerText = (idx+1) + "번. " + it[1];

    const labels = {1:"전혀 아님",2:"그렇지 않음",3:"보통",4:"그런 편",5:"매우 그럼"};
    const likert = document.getElementById("likert");
    likert.innerHTML = "";
    for(let v=1; v<=5; v++){
      const b=document.createElement("button");
      b.setAttribute("role","radio");
      b.setAttribute("aria-checked", answers[it[0]]===v ? "true":"false");
      b.innerHTML = `${v}<span>${labels[v]}</span>`;
      if(answers[it[0]]===v) b.classList.add("active");
      b.onclick=()=>{answers[it[0]]=v; render();};
      likert.appendChild(b);
    }

    document.getElementById("counter").innerText=(idx+1)+" / "+ITEMS.length;
    document.getElementById("bar").style.width=((idx+1)/ITEMS.length*100)+"%";
    const allowSkip = document.getElementById("skipToggle").checked;
    document.getElementById("nextBtn").disabled = !allowSkip && (answers[it[0]] == null);
  }

  function calc(){
    const scores={A:0,B:0,C:0,D:0,E:0}, counts={A:0,B:0,C:0,D:0,E:0};
    for(const it of ITEMS){
      let v = answers[it[0]] ?? 3;     // 무응답 3점
      if(it[3]) v = 6 - v;             // 역채점
      scores[it[2]] += v; counts[it[2]]++;
    }
    const perc={};
    ["A","B","C","D","E"].forEach(k=>{
      const max = (counts[k]||0)*5 || 1;
      perc[k] = Math.round((scores[k]/max)*100);
    });
    return {scores, perc};
  }

  function show(){
    const {scores, perc} = calc();
    const out = document.getElementById("out");
    const max = Math.max(...Object.values(scores));
    const tops = Object.entries(scores).filter(([_,v])=>v===max).map(([k])=>k);
    let html = "";

    html += `<div style="margin-bottom:6px;"><b>대표 감각</b>: ${tops.map(t=>TEXTS[t].title).join(", ")}</div>`;
    html += `<div style="margin-top:8px;margin-bottom:6px;font-weight:700">감각별 비율</div>`;
    ["A","B","C","D","E"].forEach(k=>{
      html += `
        <div class="hrow">
          <div class="label">${TEXTS[k].title}</div>
          <div class="hbar"><div class="fill" style="width:${perc[k]}%"></div></div>
          <div class="pct">${perc[k]}%</div>
        </div>`;
    });

    // 대표 감각 상세(특징/루틴/이유)
    tops.forEach(t=>{
      const contrib = ITEMS.filter(it=>it[2]===t).map(it=>{
        let v = answers[it[0]] ?? 3; if(it[3]) v = 6 - v;
        return {id:it[0], text: it[1], v};
      }).sort((a,b)=>b.v-a.v);
      const topReasons = (contrib.filter(c=>c.v>=4).slice(0,3).length>0)
        ? contrib.filter(c=>c.v>=4).slice(0,3) : contrib.slice(0,3);

      html += `
        <div class="result-card">
          <div>
            <h3 style="margin:0 0 6px">${TEXTS[t].title}</h3>
            <p><b>특징:</b> ${TEXTS[t].feature.join(" · ")}</p>
            <p><b>회복 루틴:</b></p>
            <ul style="margin:6px 0 10px 18px"><li>${TEXTS[t].routine.join("</li><li>")}</li></ul>
            <p style="margin:8px 0 4px"><b>이유(응답 근거):</b></p>
            <ul class="reason">
              ${topReasons.map(r=>`<li>${r.text} <span class="small">(응답 점수: ${r.v})</span></li>`).join("")}
            </ul>
            <p class="small" style="margin-top:8px;color:#666">${TEXTS[t].desc}</p>
          </div>
        </div>`;
    });

    out.innerHTML = html;
    out.style.display = "block";
  }

  function exportCSV(){
    const {scores, perc} = calc();
    const perItem = [];
    for(let n=1; n<=30; n++){ perItem.push(answers[String(n)] ?? 3); }
    const header = "time,A,B,C,D,E,Apct,Bpct,Cpct,Dpct,Epct," + Array.from({length:30},(_,i)=>`Q${i+1}`).join(",");
    const row = [new Date().toISOString(), scores.A,scores.B,scores.C,scores.D,scores.E, perc.A,perc.B,perc.C,perc.D,perc.E, ...perItem].join(",");
    const csv = header + "\n" + row + "\n";
    const blob=new Blob([csv],{type:"text/csv"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="youandra_sense_results.csv";
    a.click();
    URL.revokeObjectURL(a.href);
  }

  // 이벤트
  document.getElementById("nextBtn").onclick=()=>{ if(idx<order.length-1){idx++;render();}else{show();} };
  document.getElementById("prevBtn").onclick=()=>{ if(idx>0){idx--;render();} };
  document.getElementById("restart").onclick=()=>{ if(confirm("진행 중인 응답을 초기화하고 처음부터 다시 시작할까요?")) newRun(); };
  document.getElementById("skipToggle").addEventListener("change", render);
  document.getElementById("fontToggle").addEventListener("change", (e)=>{
    document.documentElement.style.setProperty("--scale", e.target.checked ? 1.3 : 1);
  });
  document.getElementById("ttsBtn").addEventListener("click", ()=>{
    try{
      const it = order[idx];
      const text = (idx+1) + "번. " + it[1];
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "ko-KR";
      window.speechSynthesis.speak(u);
    }catch(e){ alert("이 브라우저에서는 음성 읽기 지원이 제한될 수 있어요."); }
  });
  document.getElementById("exportBtn").onclick=exportCSV;

  newRun();
})();
</script>
</body>
</html>
